{"version":3,"sources":["../../../src/plugins/JSONExport.js"],"names":["JSONExport","config","defaultSettings","spaces","removeEmbeddedRelations","exportMap","exportSections","exportTags","name","request","response","json","argdown","arguments","statements","relations","settings","map","nodes","edges","sections","tags","$","JSON","stringify","key","value","undefined","module","exports"],"mappings":";;;;AAAA;;AACA;;AACA;;;;;;;;IAEMA,U;;;AACF,wBAAYC,MAAZ,EAAoB;AAAA;;AAChB,YAAIC,kBAAkB;AAClBC,oBAAQ,CADU;AAElBC,qCAAyB,KAFP;AAGlBC,uBAAW,IAHO;AAIlBC,4BAAgB,IAJE;AAKlBC,wBAAY;AALM,SAAtB;;AADgB,4HAQVL,eARU,EAQOD,MARP;;AAShB,cAAKO,IAAL,GAAY,YAAZ;AATgB;AAUnB;;;;4BACGC,O,EAASC,Q,EAAU;AACnB,gBAAID,QAAQE,IAAZ,EAAkB;AACd,qBAAKV,MAAL,GAAcQ,QAAQE,IAAtB;AACH,aAFD,MAEO,IAAIF,QAAQT,UAAZ,EAAwB;AAC3B,qBAAKC,MAAL,GAAcQ,QAAQT,UAAtB;AACH;AACD,gBAAMY,UAAU;AACZC,2BAAWH,SAASG,SADR;AAEZC,4BAAYJ,SAASI,UAFT;AAGZC,2BAAWL,SAASK;AAHR,aAAhB;AAKA,gBAAI,KAAKC,QAAL,CAAcX,SAAd,IAA2BK,SAASO,GAApC,IAA2CP,SAASO,GAAT,CAAaC,KAAxD,IAAiER,SAASO,GAAT,CAAaE,KAAlF,EAAyF;AACrFP,wBAAQK,GAAR,GAAc;AACVC,2BAAOR,SAASO,GAAT,CAAaC,KADV;AAEVC,2BAAOT,SAASO,GAAT,CAAaE;AAFV,iBAAd;AAIH;AACD,gBAAI,KAAKH,QAAL,CAAcV,cAAd,IAAgCI,SAASU,QAA7C,EAAuD;AACnDR,wBAAQQ,QAAR,GAAmBV,SAASU,QAA5B;AACH;AACD,gBAAI,KAAKJ,QAAL,CAAcT,UAAd,IAA4BG,SAASW,IAAzC,EAA+C;AAC3CT,wBAAQS,IAAR,GAAeX,SAASW,IAAxB;AACH;AACD,gBAAMC,IAAI,IAAV;AACAZ,qBAASC,IAAT,GAAgBY,KAAKC,SAAL,CACZZ,OADY,EAEZ,UAASa,GAAT,EAAcC,KAAd,EAAqB;AACjB,oBACIJ,EAAEN,QAAF,CAAWZ,uBAAX,IACAqB,OAAO,WADP,KAEC,sCAA4B,kDAF7B,CADJ,EAIE;AACE,2BAAOE,SAAP;AACH;;AAED,oBACI,CAACL,EAAEN,QAAF,CAAWV,cAAZ,IACAmB,OAAO,SADP,KAEC,sCAA4B,kDAF7B,CADJ,EAIE;AACE,2BAAOE,SAAP;AACH;;AAED,uBAAOD,KAAP;AACH,aApBW,EAqBZ,KAAKV,QAAL,CAAcb,MArBF,CAAhB;AAuBA,mBAAOO,QAAP;AACH;;;;;;AAELkB,OAAOC,OAAP,GAAiB;AACb7B,gBAAYA;AADC,CAAjB","file":"JSONExport.js","sourcesContent":["import { Argument } from \"../model/Argument.js\";\nimport { EquivalenceClass } from \"../model/EquivalenceClass.js\";\nimport { PluginWithSettings } from \"./PluginWithSettings.js\";\n\nclass JSONExport extends PluginWithSettings {\n    constructor(config) {\n        let defaultSettings = {\n            spaces: 2,\n            removeEmbeddedRelations: false,\n            exportMap: true,\n            exportSections: true,\n            exportTags: true\n        };\n        super(defaultSettings, config);\n        this.name = \"JSONExport\";\n    }\n    run(request, response) {\n        if (request.json) {\n            this.config = request.json;\n        } else if (request.JSONExport) {\n            this.config = request.JSONExport;\n        }\n        const argdown = {\n            arguments: response.arguments,\n            statements: response.statements,\n            relations: response.relations\n        };\n        if (this.settings.exportMap && response.map && response.map.nodes && response.map.edges) {\n            argdown.map = {\n                nodes: response.map.nodes,\n                edges: response.map.edges\n            };\n        }\n        if (this.settings.exportSections && response.sections) {\n            argdown.sections = response.sections;\n        }\n        if (this.settings.exportTags && response.tags) {\n            argdown.tags = response.tags;\n        }\n        const $ = this;\n        response.json = JSON.stringify(\n            argdown,\n            function(key, value) {\n                if (\n                    $.settings.removeEmbeddedRelations &&\n                    key == \"relations\" &&\n                    (this instanceof Argument || this instanceof EquivalenceClass)\n                ) {\n                    return undefined;\n                }\n\n                if (\n                    !$.settings.exportSections &&\n                    key == \"section\" &&\n                    (this instanceof Argument || this instanceof EquivalenceClass)\n                ) {\n                    return undefined;\n                }\n\n                return value;\n            },\n            this.settings.spaces\n        );\n        return response;\n    }\n}\nmodule.exports = {\n    JSONExport: JSONExport\n};\n"]}