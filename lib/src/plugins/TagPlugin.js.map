{"version":3,"sources":["../../../src/plugins/TagPlugin.js"],"names":["_","TagPlugin","config","previousSettings","settings","colorScheme","defaultsDeep","name","request","response","tags","statements","arguments","tagsDictionary","tagConfigExists","tagColorScheme","selectedTags","tagData","push","tag","tagConfig","find","clone","index","indexOf","cssClass","getHtmlId","color","length","Object","keys","title","equivalenceClass","sortedTags","sortTags","argument","filtered","filter","sorted","sortBy","module","exports"],"mappings":"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","file":"TagPlugin.js","sourcesContent":["import * as _ from 'lodash';\nimport util from './util.js';\n\nclass TagPlugin{\n  set config(config){\n    let previousSettings = this.settings;\n    if(!previousSettings){\n      previousSettings = {\n        //default colorScheme taken from ColorBrewer: https://bl.ocks.org/mbostock/5577023\n        colorScheme: [\"#1b9e77\",\"#d95f02\",\"#7570b3\",\"#e7298a\",\"#66a61e\",\"#e6ab02\",\"#a6761d\",\"#666666\"]\n      }\n    }\n    this.settings = _.defaultsDeep({}, config, previousSettings);    \n  }\n  constructor(config){\n    this.name = \"TagPlugin\";\n    this.config = config;\n  }\n  run(request, response){\n    if(!response.tags || !response.statements || !response.arguments){\n      return;\n    }\n    response.tagsDictionary = {};\n    \n    let tagConfigExists = request.tags != null;\n    if(request.tagColorScheme){\n      this.config = {colorScheme: request.tagColorScheme};      \n    }\n    let selectedTags = response.tags;\n    if(tagConfigExists){\n      selectedTags = [];\n      for(let tagData of request.tags){\n        selectedTags.push(tagData.tag);\n      }\n    }\n    for(let tag of response.tags){\n      let tagData = null;\n      if(tagConfigExists){\n        let tagConfig = _.find(request.tags,{tag:tag});\n        tagData = _.clone(tagConfig);        \n      }\n      if(!tagData){\n        tagData = {tag:tag};\n      }\n      response.tagsDictionary[tag] = tagData;\n      let index = selectedTags.indexOf(tag);\n      tagData.cssClass = util.getHtmlId('tag-'+tag);\n      if(index > -1){\n        if(!tagData.color && index < this.settings.colorScheme.length){\n          tagData.color = this.settings.colorScheme[index];\n        }\n        tagData.cssClass += ' tag'+index;\n        tagData.index = index;\n      }\n    }\n    for(let title of Object.keys(response.statements)){\n      let equivalenceClass = response.statements[title];\n      if(equivalenceClass.tags){\n        equivalenceClass.sortedTags = this.sortTags(equivalenceClass.tags, response);\n      }\n    }\n    for(let title of Object.keys(response.arguments)){\n      let argument = response.arguments[title];\n      if(argument.tags){\n        argument.sortedTags = this.sortTags(argument.tags, response);\n      }\n    }\n  }\n  sortTags(tags, response){\n    const filtered = _.filter(tags, function(tag){\n      return response.tagsDictionary[tag].index != null;\n    });\n    const sorted = _.sortBy(filtered, function(tag){\n      return response.tagsDictionary[tag].index;\n    });\n    return sorted;\n  }\n}\nmodule.exports = {\n  TagPlugin: TagPlugin\n}\n"]}