{"version":3,"sources":["../../../src/plugins/ParserPlugin.js"],"names":["_","chevrotain","tokenMatcher","ParserPlugin","config","previousSettings","settings","defaultsDeep","name","lexer","parser","data","input","verbose","lexResult","tokenize","tokens","lexerErrors","errors","ast","argdown","parserErrors","length","console","log","lastToken","last","error","token","EOF","startLine","endLine","startOffset","endOffset","startColumn","endColumn","module","exports"],"mappings":";;;;AAAA;;IAAYA,C;;AACZ;;AACA;;AACA;;IAAYC,U;;;;;;AAEZ,IAAMC,eAAeD,WAAWC,YAAhC;;IAEMC,Y;;;sBACOC,M,EAAO;AAChB,UAAIC,mBAAmB,KAAKC,QAA5B;AACA,UAAG,CAACD,gBAAJ,EAAqB;AACnBA,2BAAmB,EAAnB;AAED;AACD,WAAKC,QAAL,GAAgBN,EAAEO,YAAF,CAAe,EAAf,EAAmBH,MAAnB,EAA2BC,gBAA3B,CAAhB;AACD;;;AACD,wBAAYD,MAAZ,EAAmB;AAAA;;AACjB,SAAKI,IAAL,GAAY,cAAZ;AACA,SAAKJ,MAAL,GAAcA,MAAd;AACA,SAAKK,KAAL;AACA,SAAKC,MAAL;AACD;;;;wBACGC,I,EAAK;AACP,UAAG,CAACA,KAAKC,KAAT,EAAe;AACb,eAAOD,IAAP;AACD;AACD,UAAME,UAAUF,KAAKP,MAAL,IAAeO,KAAKP,MAAL,CAAYS,OAA3C;;AAEA,UAAIC,YAAY,KAAKL,KAAL,CAAWM,QAAX,CAAoBJ,KAAKC,KAAzB,CAAhB;AACAD,WAAKK,MAAL,GAAcF,UAAUE,MAAxB;AACAL,WAAKM,WAAL,GAAmBH,UAAUI,MAA7B;;AAEA,WAAKR,MAAL,CAAYE,KAAZ,GAAoBE,UAAUE,MAA9B;AACAL,WAAKQ,GAAL,GAAW,KAAKT,MAAL,CAAYU,OAAZ,EAAX;AACAT,WAAKU,YAAL,GAAoB,KAAKX,MAAL,CAAYQ,MAAhC;;AAEA,UAAGL,WAAWF,KAAKM,WAAhB,IAA+BN,KAAKM,WAAL,CAAiBK,MAAjB,GAA0B,CAA5D,EAA8D;AAC5DC,gBAAQC,GAAR,CAAYb,KAAKM,WAAjB;AACD;AACD,UAAGN,KAAKU,YAAL,IAAqBV,KAAKU,YAAL,CAAkBC,MAAlB,GAA2B,CAAnD,EAAqD;AACnD;AACA,YAAIG,YAAYzB,EAAE0B,IAAF,CAAOf,KAAKK,MAAZ,CAAhB;AACA,aAAI,IAAIW,KAAR,IAAiBhB,KAAKU,YAAtB,EAAmC;AACjC,cAAGM,MAAMC,KAAN,IAAe1B,aAAayB,MAAMC,KAAnB,EAA0B3B,WAAW4B,GAArC,CAAlB,EAA4D;AAC1DF,kBAAMC,KAAN,CAAYE,SAAZ,GAAwBL,UAAUM,OAAlC;AACAJ,kBAAMC,KAAN,CAAYG,OAAZ,GAAsBJ,MAAMC,KAAN,CAAYE,SAAlC;AACAH,kBAAMC,KAAN,CAAYI,WAAZ,GAA0BP,UAAUQ,SAApC;AACAN,kBAAMC,KAAN,CAAYK,SAAZ,GAAwBN,MAAMC,KAAN,CAAYI,WAApC;AACAL,kBAAMC,KAAN,CAAYM,WAAZ,GAA0BT,UAAUU,SAApC;AACAR,kBAAMC,KAAN,CAAYO,SAAZ,GAAwBR,MAAMC,KAAN,CAAYM,WAApC;AACD;AACF;AACD,YAAIrB,OAAJ,EAAY;AACVU,kBAAQC,GAAR,CAAYb,KAAKU,YAAjB;AACD;AACF;AACD,aAAOV,IAAP;AACD;;;;;;AAEHyB,OAAOC,OAAP,GAAiB;AACflC,gBAAcA;AADC,CAAjB","file":"ParserPlugin.js","sourcesContent":["import * as _ from 'lodash';\nimport {ArgdownLexer} from '../ArgdownLexer.js';\nimport {ArgdownParser} from \"../ArgdownParser.js\";\nimport * as chevrotain from 'chevrotain';\n\nconst tokenMatcher = chevrotain.tokenMatcher;\n\nclass ParserPlugin{\n  set config(config){\n    let previousSettings = this.settings;\n    if(!previousSettings){\n      previousSettings = {\n      }\n    }\n    this.settings = _.defaultsDeep({}, config, previousSettings);    \n  }\n  constructor(config){\n    this.name = \"ParserPlugin\";\n    this.config = config;\n    this.lexer = ArgdownLexer;\n    this.parser = ArgdownParser;    \n  }\n  run(data){\n    if(!data.input){\n      return data;\n    }\n    const verbose = data.config && data.config.verbose;\n    \n    let lexResult = this.lexer.tokenize(data.input);\n    data.tokens = lexResult.tokens; \n    data.lexerErrors = lexResult.errors;\n\n    this.parser.input = lexResult.tokens;\n    data.ast = this.parser.argdown();\n    data.parserErrors = this.parser.errors;\n\n    if(verbose && data.lexerErrors && data.lexerErrors.length > 0){\n      console.log(data.lexerErrors);\n    }\n    if(data.parserErrors && data.parserErrors.length > 0){\n      //add location if token is EOF\n      var lastToken = _.last(data.tokens);\n      for(let error in data.parserErrors){\n        if(error.token && tokenMatcher(error.token, chevrotain.EOF)){\n          error.token.startLine = lastToken.endLine;\n          error.token.endLine = error.token.startLine;\n          error.token.startOffset = lastToken.endOffset;\n          error.token.endOffset = error.token.startOffset;\n          error.token.startColumn = lastToken.endColumn;\n          error.token.endColumn = error.token.startColumn;\n        }\n      }\n      if (verbose){\n        console.log(data.parserErrors);\n      }\n    }\n    return data;    \n  }\n}\nmodule.exports = {\n  ParserPlugin: ParserPlugin\n}\n"]}